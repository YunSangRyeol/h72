<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC
"-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="orderMapper">

	<select id="getCartOrder"  parameterType="String" resultType="Cart">
	SELECT C.CART_ID, C.ITEM_ID, C.USER_ID, C.ITEM_FULL_NAME, C.ITEM_DETAIL_ID, C.MAIN_IMG, C.QUANTITY, C.COST, C.MESSAGE, C.KIT_YN, C.ENROLL_DATE, A.ITEM_OPTION_NAME
	FROM CART C, ITEM_ALL_VIEW A
	WHERE C.ITEM_ID = A.ITEM_ID
	AND CART_ID = #{cartAll}
	</select>
	
	<insert id="insertBankInfo" parameterType="java.util.HashMap">
	INSERT INTO VBANK VALUES(#{orderNo},#{vbankName},#{vbankNum},#{vName})
	
	</insert>
	
	<insert id="insertOrderInfo" parameterType="Order">
	INSERT INTO ORDER_LIST VALUES(#{orderNo},#{userId},#{deleveryName},#{mainImgN1},#{itemNameN1},#{itemOptionNameN1},#{totalQuantity},#{kindsQuantity},#{totalPrice},#{paymentMethod},#{paymentPoint},#{totalSavingPoint},#{deliveryPee},#{phone},#{postNum},#{address},#{addressDetail},#{deliveryMessage},#{orderStatus},#{orderChange},SYSDATE)
	
	</insert>
	
	<insert id="insertOrderContents" parameterType="OrderContents">
	INSERT INTO ORDER_LIST_CONTENTS VALUES(#{orderNo},#{itemId},#{itemName},#{itemOptionName},#{itemDetailID},#{mainImg},#{quantity},#{savingPoint},#{cost},#{message},#{kitYN})
	</insert>
	
	<delete id="deleteFinishCart" parameterType="String">
		DELETE FROM CART
		WHERE  CART_ID= #{cartId}
	</delete>
		
	<select id="selectOrderList" parameterType="java.util.HashMap" resultType="Order">
	 SELECT * FROM (SELECT ROWNUM RNUM, ORDER_NO, USER_ID, DELEVERY_NAME,MAIN_IMG_N1, ITEM_NAME_N1, ITEM_OPTION_NAME_N1, TOTAL_QUANTITY, KINDS_QUANTITY, TOTAL_PRICE, PAYMENT_METHOD, PYMNET_POINT, TOTAL_SAVING_POINT, DELEVERY_PEE, PHONE, POST_NUM, ADDRESS, ADDRESS_DETAIL, DELIVERY_MESSAGE, ORDER_STATUS, ORDER_CHANGE, ENROLL_DATE
	 FROM (SELECT * FROM ORDER_LIST 
	 WHERE USER_ID=#{userId} AND ENROLL_DATE BETWEEN TO_DATE(#{preThreeMonth}) AND TO_DATE(#{currentDate})+1))
	 WHERE RNUM >= #{startRow} AND RNUM <![CDATA[<]]>= #{endRow} 
	</select>	
	
	<select id="getListCount" parameterType="java.util.HashMap" resultType="Integer">
	 SELECT COUNT(*) FROM ORDER_LIST
	 WHERE USER_ID=#{userId} AND ENROLL_DATE BETWEEN TO_DATE(#{preThreeMonth}) AND TO_DATE(#{currentDate})+1
	</select>	
	
</mapper>